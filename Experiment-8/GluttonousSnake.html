<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>GluttonousSnake</title>
</head>
<style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", "PingFang SC", Arial, sans-serif;
        background-color: #D6E4E5;
        color: #333;
        padding: 0;
        margin: 0;
    }

    button {
        font-size: 1.1em;
        font-weight: bold;
        background-color: #D6E4E5;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        padding: 10px;
        margin: 20px auto;
        text-align: center;
        display: block;
    }

    #main {
        display: grid;
        grid-template-columns: auto auto;
        justify-content: center;
        padding: 20px;
    }

    #inputArea {
        background-color: #EFF5F5;
        border-radius: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        margin: 50px 0 0 50px;
        padding: 20px;
        height: fit-content;
        width: fit-content;
        float: left;
    }

    #gameArea {
        background-color: #EFF5F5;
        border-radius: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        margin: 50px;
        padding: 20px;
        height: fit-content;
        width: fit-content;
        float: left;
        white-space: nowrap;
    }

    #gameArea div {
        float: left;
        background-color: #eee;
    }
</style>
<body>
<div id="main">
    <div id="inputArea">
        <h1 style="text-align: center;">è´ªåƒè›‡æ¸¸æˆ</h1>
        <h3 style="text-align: center;">å½“å‰å¾—åˆ†ï¼š<span id="score">0</span></h3>
        <table>
            <tr>
                <td style="text-align: right;"><label for="speed">åˆ·æ–°é€Ÿåº¦ï¼ˆmsï¼‰ï¼š</label></td>
                <td><input type="number" id="speed" value="800" min="1"
                           oninput="this.value = this.value.replace(/[^\d]/g, '')"></td>
            </tr>
            <tr>
                <td style="text-align: right;"><label for="cellLength">æ ¼å­è¾¹é•¿ï¼ˆpxï¼‰ï¼š</label></td>
                <td><input type="number" id="cellLength" value="64" min="1"
                           oninput="this.value = this.value.replace(/[^\d]/g, '')" onchange="resetGameArea()"></td>
            </tr>
            <tr>
                <td style="text-align: right;"><label for="cellMargin">æ ¼å­é—´è·ï¼ˆpxï¼‰ï¼š</label></td>
                <td><input type="number" id="cellMargin" value="0" min="0"
                           oninput="this.value = this.value.replace(/[^\d]/g, '')" onchange="resetGameArea()"></td>
            </tr>
            <tr>
                <td style="text-align: right;"><label for="gameAreaWidth">å®½åº¦ï¼ˆæ ¼ï¼‰ï¼š</label></td>
                <td><input type="number" id="gameAreaWidth" value="10" min="3"
                           oninput="this.value = this.value.replace(/[^\d]/g, '')" onchange="resetGameArea()"></td>
            </tr>
            <tr>
                <td style="text-align: right;"><label for="gameAreaHeight">é«˜åº¦ï¼ˆæ ¼ï¼‰ï¼š</label></td>
                <td><input type="number" id="gameAreaHeight" value="10" min="3"
                           oninput="this.value = this.value.replace(/[^\d]/g, '')" onchange="resetGameArea()"></td>
            </tr>
        </table>
        <button id="start" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
    </div>
    <div id="gameArea">
    </div>
</div>
</body>
<script>
    // é‡æ–°è®¾ç½®æ¸¸æˆåŒºåŸŸ
    function resetGameArea() {
        let cellLength = Number(document.getElementById("cellLength").value);
        let gameAreaWidth = Number(document.getElementById("gameAreaWidth").value);
        let gameAreaHeight = Number(document.getElementById("gameAreaHeight").value);
        let gameArea = document.getElementById("gameArea");
        // è¾“å…¥æ ¡éªŒ
        if (gameAreaWidth < 3) {
            alert("å®½åº¦å’Œé«˜åº¦å¿…é¡»å¤§äºç­‰äº3ï¼");
            document.getElementById("gameAreaWidth").value = 3;
            gameAreaWidth = 3;
        } else if (gameAreaHeight < 3) {
            alert("å®½åº¦å’Œé«˜åº¦å¿…é¡»å¤§äºç­‰äº3ï¼");
            document.getElementById("gameAreaHeight").value = 3;
            gameAreaHeight = 3;
        }
        // æ¸…ç©ºåŸæœ‰å†…å®¹
        gameArea.innerHTML = "";
        // å¡«å……æ ¼å­
        let table = document.createElement("table");
        table.style.borderSpacing = document.getElementById("cellMargin").value + "px";
        for (let i = 0; i < gameAreaHeight + 2; i++) {
            let row = document.createElement("tr");
            for (let j = 0; j < gameAreaWidth + 2; j++) {
                let cell = document.createElement("td");
                cell.id = "cell-" + i + "-" + j;
                cell.style.width = cellLength + "px";
                cell.style.height = cellLength + "px";
                cell.style.padding = "0";
                // èƒŒæ™¯è®¾ç½®ä¸ºæ£‹ç›˜è‰²
                if (i % 2 === 0 && j % 2 === 0 || i % 2 === 1 && j % 2 === 1) {
                    cell.style.backgroundColor = "#eee";
                } else {
                    cell.style.backgroundColor = "#ddd";
                }
                // è®¾ç½®è¾¹ç•Œå¢™é¢
                if (i === 0 || i === gameAreaHeight + 1 || j === 0 || j === gameAreaWidth + 1) {
                    if (i === 0 && j === 0) {
                        drawCanvas(cell, "WallCorner", 270);
                    } else if (i === 0 && j === gameAreaWidth + 1) {
                        drawCanvas(cell, "WallCorner", 0);
                    } else if (i === gameAreaHeight + 1 && j === 0) {
                        drawCanvas(cell, "WallCorner", 180);
                    } else if (i === gameAreaHeight + 1 && j === gameAreaWidth + 1) {
                        drawCanvas(cell, "WallCorner", 90);
                    } else if (i === 0) {
                        drawCanvas(cell, "Wall", 0);
                    } else if (j === 0) {
                        drawCanvas(cell, "Wall", 270);
                    } else if (j === gameAreaWidth + 1) {
                        drawCanvas(cell, "Wall", 90);
                    } else if (i === gameAreaHeight + 1) {
                        drawCanvas(cell, "Wall", 180);
                    }
                } else if (i === 1 && j === 1) {
                    drawCanvas(cell, "Food", 0); //æµ‹è¯•
                }
                row.appendChild(cell);
            }
            table.appendChild(row);
        }
        gameArea.appendChild(table);
    }

    resetGameArea(); // è½½å…¥é¡µé¢åç«‹å³åˆå§‹åŒ–æ¸¸æˆåŒºåŸŸä¸€æ¬¡

    // é€‚é…é«˜æ¸…å±
    function createHDCanvas(canvas, l, ratio) {
        canvas.width = l * ratio; // å®é™…æ¸²æŸ“åƒç´ 
        canvas.height = l * ratio; // å®é™…æ¸²æŸ“åƒç´ 
        canvas.style.width = `${l}px`; // æ§åˆ¶æ˜¾ç¤ºå¤§å°
        canvas.style.height = `${l}px`; // æ§åˆ¶æ˜¾ç¤ºå¤§å°
        return canvas;
    }

    // canvasç»˜åˆ¶
    function drawCanvas(cell, type, rotation) {
        cell.innerHTML = "";  // æ¸…é™¤åŸæœ‰å†…å®¹
        let ratio = window.devicePixelRatio || 1;
        let cellLength = Number(document.getElementById("cellLength").value);
        if (type === "Food") {  // é£Ÿç‰©ä¸éœ€è¦ç»˜åˆ¶ï¼Œç›´æ¥ä½¿ç”¨ emoji
            let div = document.createElement("div");
            div.style.width = cellLength + "px";
            div.style.height = cellLength + "px";
            div.style.fontSize = cellLength * 0.5 + "px";
            div.style.lineHeight = cellLength + "px";
            div.style.textAlign = "center";
            div.style.margin = 0;
            div.style.padding = 0;
            div.innerHTML = "ğŸ­";
            cell.appendChild(div);
            return;
        }
        let canvas = document.createElement("canvas");
        canvas.style.display = "block";
        canvas.style.padding = "0";
        canvas.style.margin = "0";
        canvas = createHDCanvas(canvas, cellLength, ratio);
        let ctx = canvas.getContext("2d");
        let pl = cellLength * ratio / 16;  // PixelLength æ ‡å‡†åƒç´ é•¿åº¦
        function PL(n) {
            return n * pl;
        }

        // ç»˜åˆ¶å¢™é¢
        if (type === "Wall") {
            // å¡«å……èƒŒæ™¯
            ctx.fillStyle = "#45283C";
            ctx.fillRect(PL(0), PL(0), PL(16), PL(16));
            // ç»˜åˆ¶ç –å—
            ctx.fillStyle = "#8F563B";
            ctx.fillRect(PL(0), PL(1), PL(4), PL(3));
            ctx.fillRect(PL(5), PL(1), PL(7), PL(3));
            ctx.fillRect(PL(13), PL(1), PL(3), PL(3));
            ctx.fillRect(PL(1), PL(5), PL(7), PL(3));
            ctx.fillRect(PL(9), PL(5), PL(7), PL(3));
            ctx.fillRect(PL(0), PL(9), PL(4), PL(3));
            ctx.fillRect(PL(5), PL(9), PL(7), PL(3));
            ctx.fillRect(PL(13), PL(9), PL(3), PL(3));
            ctx.fillRect(PL(1), PL(13), PL(7), PL(3));
            ctx.fillRect(PL(9), PL(13), PL(7), PL(3));
        }
        // ç»˜åˆ¶å¢™è§’
        if (type === "WallCorner") {
            // å¡«å……èƒŒæ™¯
            ctx.fillStyle = "#45283C";
            ctx.fillRect(PL(0), PL(0), PL(16), PL(16));
            // ç»˜åˆ¶ç –å—
            ctx.fillStyle = "#8F563B";
            ctx.fillRect(PL(0), PL(1), PL(4), PL(3));
            ctx.fillRect(PL(5), PL(1), PL(7), PL(3));
            ctx.fillRect(PL(13), PL(1), PL(2), PL(3));
            ctx.fillRect(PL(12), PL(5), PL(3), PL(7));
            ctx.fillRect(PL(12), PL(13), PL(3), PL(3));
            ctx.fillRect(PL(1), PL(5), PL(7), PL(3));
            ctx.fillRect(PL(9), PL(5), PL(2), PL(3));
            ctx.fillRect(PL(8), PL(9), PL(3), PL(7));
            ctx.fillRect(PL(0), PL(9), PL(4), PL(3));
            ctx.fillRect(PL(5), PL(9), PL(2), PL(3));
            ctx.fillRect(PL(4), PL(13), PL(3), PL(3));
            ctx.fillRect(PL(1), PL(13), PL(2), PL(3));
        }
        // ç»˜åˆ¶è›‡å¤´
        if (type === "SnakeHead") {
            // æ·±è‰²æè¾¹
            ctx.fillStyle = "#222034";
            ctx.fillRect(PL(5), PL(2), PL(6), PL(1));
            ctx.fillRect(PL(4), PL(3), PL(8), PL(1));
            ctx.fillRect(PL(3), PL(4), PL(10), PL(1));
            ctx.fillRect(PL(2), PL(5), PL(12), PL(11));
            ctx.fillRect(PL(1), PL(7), PL(14), PL(7));
            ctx.fillRect(PL(0), PL(9), PL(16), PL(4));
            // çº¢è‰²éƒ¨åˆ†
            ctx.fillStyle = "#D95763";
            ctx.fillRect(PL(7), PL(0), PL(2), PL(2));
            // ç»¿è‰²éƒ¨åˆ†
            ctx.fillStyle = "#99E550";
            ctx.fillRect(PL(5), PL(3), PL(6), PL(1));
            ctx.fillRect(PL(4), PL(4), PL(8), PL(1));
            ctx.fillRect(PL(3), PL(5), PL(10), PL(11));
            ctx.fillRect(PL(2), PL(7), PL(12), PL(7));
            ctx.fillRect(PL(1), PL(9), PL(14), PL(4));
            // ç™½è‰²éƒ¨åˆ†
            ctx.fillStyle = "#FFFFFF";
            ctx.fillRect(PL(4), PL(9), PL(2), PL(4));
            ctx.fillRect(PL(3), PL(10), PL(4), PL(2));
            ctx.fillRect(PL(10), PL(9), PL(2), PL(4));
            ctx.fillRect(PL(9), PL(10), PL(4), PL(2));
            // æ·±è‰²ç»†èŠ‚
            ctx.fillStyle = "#222034";
            ctx.fillRect(PL(6), PL(5), PL(1), PL(1));
            ctx.fillRect(PL(9), PL(5), PL(1), PL(1));
            ctx.fillRect(PL(4), PL(10), PL(1), PL(1));
            ctx.fillRect(PL(10), PL(10), PL(1), PL(1));
        }
        // ç»˜åˆ¶ç›´è›‡èº«
        if (type === "SnakeBodyStraight") {
            // æ·±è‰²æè¾¹
            ctx.fillStyle = "#222034";
            ctx.fillRect(PL(2), PL(0), PL(12), PL(1));
            ctx.fillRect(PL(1), PL(1), PL(12), PL(2));
            ctx.fillRect(PL(0), PL(3), PL(12), PL(2));
            ctx.fillRect(PL(1), PL(5), PL(12), PL(2));
            ctx.fillRect(PL(2), PL(7), PL(12), PL(2));
            ctx.fillRect(PL(3), PL(9), PL(12), PL(2));
            ctx.fillRect(PL(4), PL(11), PL(12), PL(2));
            ctx.fillRect(PL(3), PL(13), PL(12), PL(2));
            ctx.fillRect(PL(2), PL(15), PL(12), PL(1));
            // ç»¿è‰²éƒ¨åˆ†
            ctx.fillStyle = "#99E550";
            ctx.fillRect(PL(3), PL(0), PL(10), PL(1));
            ctx.fillRect(PL(2), PL(1), PL(10), PL(2));
            ctx.fillRect(PL(1), PL(3), PL(10), PL(2));
            ctx.fillRect(PL(2), PL(5), PL(10), PL(2));
            ctx.fillRect(PL(3), PL(7), PL(10), PL(2));
            ctx.fillRect(PL(4), PL(9), PL(10), PL(2));
            ctx.fillRect(PL(5), PL(11), PL(10), PL(2));
            ctx.fillRect(PL(4), PL(13), PL(10), PL(2));
            ctx.fillRect(PL(3), PL(15), PL(10), PL(1));
        }
        // ç»˜åˆ¶å¼¯è›‡èº«
        if (type === "SnakeBodyBend") {
            // æ·±è‰²æè¾¹
            ctx.fillStyle = "#222034";
            ctx.fillRect(PL(0), PL(2), PL(1), PL(1));
            ctx.fillRect(PL(1), PL(1), PL(3), PL(1));
            ctx.fillRect(PL(4), PL(0), PL(4), PL(1));
            ctx.fillRect(PL(8), PL(1), PL(3), PL(1));
            ctx.fillRect(PL(11), PL(2), PL(2), PL(1));
            ctx.fillRect(PL(13), PL(3), PL(1), PL(2));
            ctx.fillRect(PL(14), PL(5), PL(1), PL(3));
            ctx.fillRect(PL(15), PL(8), PL(1), PL(4));
            ctx.fillRect(PL(14), PL(12), PL(1), PL(3));
            ctx.fillRect(PL(13), PL(15), PL(1), PL(1));
            ctx.fillRect(PL(0), PL(13), PL(1), PL(1));
            ctx.fillRect(PL(1), PL(12), PL(2), PL(1));
            ctx.fillRect(PL(3), PL(13), PL(1), PL(2));
            ctx.fillRect(PL(2), PL(15), PL(1), PL(1));
            // ç»¿è‰²éƒ¨åˆ†
            ctx.fillStyle = "#99E550";
            ctx.fillRect(PL(4), PL(1), PL(4), PL(1));
            ctx.fillRect(PL(1), PL(2), PL(10), PL(1));
            ctx.fillRect(PL(0), PL(3), PL(13), PL(2));
            ctx.fillRect(PL(0), PL(5), PL(14), PL(3));
            ctx.fillRect(PL(0), PL(8), PL(15), PL(4));
            ctx.fillRect(PL(0), PL(12), PL(1), PL(1));
            ctx.fillRect(PL(3), PL(12), PL(11), PL(1));
            ctx.fillRect(PL(4), PL(13), PL(10), PL(2));
            ctx.fillRect(PL(3), PL(15), PL(10), PL(1));
        }
        // ç»˜åˆ¶è›‡å°¾
        if (type === "SnakeTail") {
            // æ·±è‰²æè¾¹
            ctx.fillStyle = "#222034";
            ctx.fillRect(PL(2), PL(0), PL(1), PL(2));
            ctx.fillRect(PL(1), PL(2), PL(1), PL(4));
            ctx.fillRect(PL(2), PL(6), PL(1), PL(3));
            ctx.fillRect(PL(3), PL(9), PL(1), PL(2));
            ctx.fillRect(PL(4), PL(11), PL(1), PL(1));
            ctx.fillRect(PL(5), PL(12), PL(1), PL(1));
            ctx.fillRect(PL(6), PL(13), PL(1), PL(2));
            ctx.fillRect(PL(7), PL(15), PL(1), PL(1));
            ctx.fillRect(PL(8), PL(10), PL(1), PL(5));
            ctx.fillRect(PL(9), PL(6), PL(1), PL(4));
            ctx.fillRect(PL(10), PL(3), PL(1), PL(3));
            ctx.fillRect(PL(11), PL(2), PL(1), PL(1));
            ctx.fillRect(PL(12), PL(1), PL(1), PL(1));
            ctx.fillRect(PL(13), PL(0), PL(1), PL(1));
            // ç»¿è‰²éƒ¨åˆ†
            ctx.fillStyle = "#99E550";
            ctx.fillRect(PL(3), PL(0), PL(10), PL(1));
            ctx.fillRect(PL(3), PL(1), PL(9), PL(1));
            ctx.fillRect(PL(2), PL(2), PL(9), PL(1));
            ctx.fillRect(PL(2), PL(3), PL(8), PL(3));
            ctx.fillRect(PL(3), PL(6), PL(6), PL(3));
            ctx.fillRect(PL(4), PL(9), PL(5), PL(1));
            ctx.fillRect(PL(4), PL(10), PL(4), PL(1));
            ctx.fillRect(PL(5), PL(11), PL(3), PL(1));
            ctx.fillRect(PL(6), PL(12), PL(2), PL(1));
            ctx.fillRect(PL(7), PL(13), PL(1), PL(2));
        }
        canvas.style.transform = `rotate(${rotation}deg)`;  // æ—‹è½¬
        cell.appendChild(canvas);
    }

    // å¼€å§‹æ¸¸æˆ
    function startGame() {
        // ç¦æ­¢ä¿®æ”¹æ¸¸æˆåŒºåŸŸè®¾ç½®
        document.getElementById("speed").disabled = true;
        document.getElementById("cellLength").disabled = true;
        document.getElementById("cellMargin").disabled = true;
        document.getElementById("gameAreaWidth").disabled = true;
        document.getElementById("gameAreaHeight").disabled = true;
        // åˆ›å»º
    }
</script>
</html>